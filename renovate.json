{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "description": "Configuration Renovate pour CassKai - Mises √† jour automatiques des d√©pendances",
  
  "extends": [
    "config:base",
    "docker:enableMajor",
    "security:openssf-scorecard"
  ],
  
  "timezone": "Europe/Paris",
  "schedule": ["before 6am on monday"],
  
  "labels": ["dependencies", "renovate"],
  "assignees": ["@casskai-team"],
  
  "prConcurrentLimit": 5,
  "prHourlyLimit": 2,
  
  "separateMajorMinor": true,
  "separateMultipleMajor": true,
  "separateMinorPatch": false,
  
  "groupName": "all non-major dependencies",
  "groupSlug": "all-minor-patch",
  
  "lockFileMaintenance": {
    "enabled": true,
    "schedule": ["before 6am on saturday"]
  },
  
  "packageRules": [
    {
      "description": "Grouper les mises √† jour des types TypeScript",
      "matchPackagePatterns": ["@types/"],
      "groupName": "TypeScript types",
      "schedule": ["before 6am on wednesday"]
    },
    
    {
      "description": "Grouper les outils de d√©veloppement",
      "matchPackagePatterns": [
        "eslint",
        "prettier",
        "@typescript-eslint/",
        "husky",
        "lint-staged"
      ],
      "groupName": "Development tools",
      "schedule": ["before 6am on thursday"]
    },
    
    {
      "description": "Grouper les outils de test",
      "matchPackagePatterns": [
        "vitest",
        "@vitest/",
        "@playwright/",
        "@testing-library/"
      ],
      "groupName": "Testing tools",
      "schedule": ["before 6am on friday"]
    },
    
    {
      "description": "Grouper les composants UI Radix",
      "matchPackagePatterns": ["@radix-ui/"],
      "groupName": "Radix UI components",
      "schedule": ["before 6am on tuesday"]
    },
    
    {
      "description": "Supabase - mises √† jour critiques en priorit√©",
      "matchPackageNames": ["@supabase/supabase-js"],
      "reviewersFromCodeOwners": true,
      "addLabels": ["critical-dependency"],
      "prPriority": 10
    },
    
    {
      "description": "React et React DOM - mises √† jour majeures avec attention",
      "matchPackageNames": ["react", "react-dom"],
      "matchUpdateTypes": ["major"],
      "reviewersFromCodeOwners": true,
      "addLabels": ["breaking-change"],
      "prPriority": 5,
      "schedule": ["at any time"]
    },
    
    {
      "description": "Dependencies de s√©curit√© - mise √† jour imm√©diate",
      "matchDatasources": ["npm"],
      "matchUpdateTypes": ["patch"],
      "vulnerabilityAlerts": {
        "enabled": true,
        "schedule": ["at any time"],
        "prPriority": 20,
        "addLabels": ["security"]
      }
    },
    
    {
      "description": "Node.js - mises √† jour LTS uniquement",
      "matchPackageNames": ["node"],
      "allowedVersions": "/^(18|20)\\./",
      "reviewersFromCodeOwners": true
    },
    
    {
      "description": "Vite et plugins - grouper ensemble",
      "matchPackagePatterns": ["vite", "@vitejs/"],
      "groupName": "Vite toolchain",
      "schedule": ["before 6am on wednesday"]
    },
    
    {
      "description": "Docker base images - mises √† jour s√©curis√©es",
      "matchDatasources": ["docker"],
      "matchPackageNames": ["node", "nginx", "postgres", "redis"],
      "versioning": "docker",
      "schedule": ["before 6am on saturday"]
    },
    
    {
      "description": "Pin versions pour les outils critiques",
      "matchPackageNames": [
        "typescript",
        "@types/node"
      ],
      "rangeStrategy": "pin"
    },
    
    {
      "description": "Ignorer certaines d√©pendances probl√©matiques",
      "matchPackageNames": [
        "chalk"
      ],
      "enabled": false,
      "description": "Chalk v5 est ESM-only, peut casser la compatibilit√©"
    },
    
    {
      "description": "Auto-merge des mises √† jour mineures pour les types",
      "matchPackagePatterns": ["@types/"],
      "matchUpdateTypes": ["minor", "patch"],
      "automerge": true,
      "platformAutomerge": true,
      "automergeType": "pr",
      "automergeStrategy": "squash"
    },
    
    {
      "description": "Auto-merge des patches de s√©curit√© apr√®s tests",
      "matchUpdateTypes": ["patch"],
      "vulnerabilityAlerts": {
        "enabled": true
      },
      "automerge": true,
      "platformAutomerge": true,
      "automergeType": "pr",
      "automergeStrategy": "squash",
      "requiredStatusChecks": [
        "build",
        "test",
        "lint"
      ]
    }
  ],
  
  "regexManagers": [
    {
      "description": "D√©tecter les versions dans les fichiers Docker",
      "fileMatch": ["^Dockerfile$", "^\\.?Dockerfile\\.[^/]*$"],
      "matchStrings": [
        "# renovate: datasource=(?<datasource>\\S+) depName=(?<depName>\\S+)\\s*\\n.*?_VERSION\\s*=\\s*\"?(?<currentValue>\\S+?)\"?"
      ]
    },
    
    {
      "description": "D√©tecter les versions dans docker-compose",
      "fileMatch": ["docker-compose\\.ya?ml$"],
      "matchStrings": [
        "# renovate: datasource=(?<datasource>\\S+) depName=(?<depName>\\S+)\\s*\\n\\s*image:\\s*[^:]+:(?<currentValue>\\S+)"
      ]
    },
    
    {
      "description": "D√©tecter les versions dans GitHub Actions",
      "fileMatch": ["\\.github/workflows/.+\\.ya?ml$"],
      "matchStrings": [
        "# renovate: datasource=(?<datasource>\\S+) depName=(?<depName>\\S+)\\s*\\n.*?uses:\\s*(?<depName>\\S+?)@(?<currentValue>\\S+)"
      ]
    }
  ],
  
  "customManagers": [
    {
      "customType": "regex",
      "description": "Versions de Node.js dans les fichiers de config",
      "fileMatch": [
        "package\\.json$",
        "\\.nvmrc$",
        "README\\.md$"
      ],
      "matchStrings": [
        "\"node\":\\s*\"(?<currentValue>[\\d\\.]+)\"",
        "node_version:\\s*(?<currentValue>[\\d\\.]+)",
        "Node\\.js\\s*(?<currentValue>[\\d\\.]+)"
      ],
      "datasourceTemplate": "node-version",
      "depNameTemplate": "node"
    }
  ],
  
  "hostRules": [
    {
      "matchHost": "github.com",
      "concurrentRequestLimit": 2
    }
  ],
  
  "onboarding": false,
  "requireConfig": "optional",
  
  "commitMessageTopic": "{{depName}}",
  "commitMessageAction": "update",
  "commitMessagePrefix": "chore(deps): ",
  "commitMessageExtra": "to {{newVersion}}",
  
  "prTitle": "{{commitMessagePrefix}}{{commitMessageAction}} {{commitMessageTopic}}{{commitMessageExtra}}",
  "prBodyDefinitions": {
    "OpenSSF": "[![OpenSSF Scorecard](https://api.securityscorecards.dev/projects/github.com/{{sourceRepo}}/badge)](https://securityscorecards.dev/viewer/?uri=github.com/{{sourceRepo}})"
  },
  "prBodyTemplate": "{{{header}}}{{{table}}}{{{notes}}}{{{changelogs}}}{{{controls}}}{{{footer}}}",
  
  "prFooter": "ü§ñ Cette PR a √©t√© g√©n√©r√©e automatiquement par Renovate Bot.\n\n---\n**Checklist avant merge :**\n- [ ] Tests automatiques pass√©s ‚úÖ\n- [ ] Pas de breaking changes d√©tect√©s\n- [ ] Changelog mis √† jour si n√©cessaire\n- [ ] Documentation mise √† jour si n√©cessaire",
  
  "ignorePaths": [
    "**/node_modules/**",
    "**/bower_components/**",
    "**/vendor/**",
    "**/examples/**",
    "**/tests/fixtures/**"
  ],
  
  "ignoreDeps": [
    "@types/node"
  ],
  
  "enabledManagers": [
    "npm",
    "dockerfile",
    "docker-compose",
    "github-actions",
    "regex"
  ],
  
  "configWarningReuseIssue": false,
  
  "dependencyDashboard": true,
  "dependencyDashboardTitle": "üìã Tableau de bord des d√©pendances",
  "dependencyDashboardHeader": "Ce tableau de bord liste toutes les mises √† jour de d√©pendances d√©tect√©es par Renovate.\n\n- üü¢ **√Ä jour** : Aucune mise √† jour disponible\n- üü° **Mise √† jour disponible** : Nouvelle version d√©tect√©e\n- üî¥ **Vuln√©rabilit√©** : Mise √† jour de s√©curit√© requise\n\n---",
  "dependencyDashboardFooter": "\n---\n\nüí° **Configuration Renovate** : Voir `renovate.json` pour les r√®gles de mise √† jour.\n\nüîß **Support** : Ouvrir une issue pour modifier la configuration Renovate."
}